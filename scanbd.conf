/*
 * $Id$
 *
 *  scanbd - KMUX scanner button daemon
 *
 *  Copyright (C) 2008  Wilhelm Meier (wilhelm.meier@fh-kl.de)
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */


# global settings
global {
	# turn on debugging
	debug   = true
	debug-level = 7
	
	# drop priviliges to this
	user    = root # saned
	group   = root # scanner

	# the saned executable for manager-mode
	saned   = "/usr/sbin/saned"
	saned_opt  = {} # string-list

	# poll timeout in [ms]
	# (for polling the devices)
	timeout = 500 
	
	pidfile = "/var/run/scanbd.pid"
	
	# env-vars for the scripts
	environment {
		# pass the device label as below in this env-var
		device = "SCANBD_DEVICE"
		# pass the action label as below in this env-var
		action = "SCANBD_ACTION"
 	}

	# function definitions
	# values of the options are simply passed via env-vars

	function function_knob {
		filter = "^message.*"
		desc   = "The value of the function knob / wheel / selector"
		env    = "SCANBD_FUNCTION" 
	}
	function function_mode {
		filter = "^mode.*"
		desc   = "Color mode"
		env    = "SCANBD_FUNCTION_MODE" 
	}

	# action definitions
	# if the filter matches and the value changes 
	# from from-value to to-value,
	# <script> is executed
	
	# since we can have only a most one action for each option, the action-script 
	# can use the function definition (see above) to distinguish different tasks 
	# (e.g. use the env-var SCANBD_FUNCTION defined above)
	
	action scan {
		filter = "^scan.*"
		numerical-trigger {
			from-value = 1
			to-value   = 0
		}
		desc   = "Scan to file"
		# script must be an absolute pathname to the action script without arguments
		script = "/usr/bin/scanadf"
	}
	action email {
		filter = "^email$"
		string-trigger {
			from-value  = ""        
			to-value    = "^email.*"
		}
		desc   = "Scan to email"
		# script must be an absolute pathname to the action script without arguments
		script = ""
	}
	action copy {
		filter = "^copy$"
		string-trigger {
			from-value  = ""
			to-value    = "^copy.*"
		}
		desc   = "Copy to printer"
		# script must be an absolute pathname to the action script without arguments
		script = ""
	}
	action preview {
		filter = "^preview$"
		numerical-trigger {
			from-value = 1
			to-value   = 0
		}
		desc   = "Preview"
		# script must be an absolute pathname to the action script without arguments
		script = "/tmp/example.script"
	}
       	action globaltest {
       	             filter = "^message.*"
	      	     desc   = "Test (print all env vars)"
		     # script must be an absolute pathname to the action script without arguments
	      	     script = "/usr/bin/printenv"
        }
}

# devices 
# each device can have action and function

device fujitsu {
       # the device matching string
       filter = "^fujitsu.*" # regex

       # the device description
       desc = "Fujitsu: Test"
}

device snapscan {
       # the device matching string
       filter = "^snapscan.*" # regex

       # the device description
       desc = "Epson"

       action test {
       	      filter = "^message.*"
	      desc   = "Test"

	      # script must be an absolute pathname to the action script without arguments
	      script = "/tmp/example.script"
       }
}

device avision {
       # the device matching string
       filter = "^avision.*"

       # the device description
       desc = "Avision Scanner"

       # device specific actions (as above)
       # (if this matches a previous defined action, it overrides) 
       
       action duplex-test {
       	      filter = "^message.*"
	      desc   = "Avision: Duplex Test"

	      # script must be an absolute pathname to the action script without arguments
	      script = "/usr/bin/printenv"

	      string-trigger {
	      		     from-value  = ""
			     to-value    = "^.:duplex"
	      }
       }
}

